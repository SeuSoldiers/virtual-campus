<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="seu.virtualcampus.mapper.ProductMapper">
    
    <!-- 批量插入商品 -->
    <insert id="insertBatch" parameterType="java.util.List">
        INSERT INTO product(productId, productName, productPrice, availableCount, productType, status)
        VALUES
        <foreach collection="list" item="product" separator=",">
            (#{product.productId}, #{product.productName}, #{product.productPrice}, 
             #{product.availableCount}, #{product.productType}, #{product.status})
        </foreach>
    </insert>

    <!-- 批量删除商品 -->
    <delete id="deleteByIds">
        DELETE FROM product WHERE productId IN
        <foreach collection="list" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!-- 新增：分页查询商品（带过滤） -->
    <select id="selectPaged" resultType="seu.virtualcampus.domain.Product">
        SELECT * FROM product
        <where>
            <if test="status != null and status != ''">
                status = #{status}
            </if>
            <if test="search != null and search != ''">
                <if test="status != null and status != ''">
                    AND
                </if>
                (
                    productName LIKE '%' || #{search} || '%' OR
                    productType LIKE '%' || #{search} || '%' OR
                    productId   LIKE '%' || #{search} || '%'
                )
            </if>
        </where>
        <if test="orderBy != null and orderBy != ''">
            ORDER BY ${orderBy}
        </if>
        LIMIT #{size} OFFSET #{offset}
    </select>

    <!-- 统计（带过滤） -->
    <select id="countByFilter" resultType="long">
        SELECT COUNT(*) FROM product
        <where>
            <if test="status != null and status != ''">
                status = #{status}
            </if>
            <if test="search != null and search != ''">
                <if test="status != null and status != ''">
                    AND
                </if>
                (
                    productName LIKE '%' || #{search} || '%' OR
                    productType LIKE '%' || #{search} || '%' OR
                    productId   LIKE '%' || #{search} || '%'
                )
            </if>
        </where>
    </select>

</mapper>
