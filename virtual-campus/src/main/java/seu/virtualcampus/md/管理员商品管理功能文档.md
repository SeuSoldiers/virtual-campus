# 管理员商品管理功能实现文档

## 📋 功能概述

管理员商品管理页面为管理员提供完整的商品CRUD操作，包括商品的新增、编辑、删除、上下架等功能，采用左右分栏布局，左侧为商品列表，右侧为编辑表单。

## 🎯 核心功能

### 1. 页面结构

**FXML文件**: `admin_products.fxml`
- **顶部工具栏**: 搜索、筛选、新增按钮
- **左侧商品列表**: TableView展示商品信息和操作按钮
- **右侧编辑表单**: 商品信息输入和保存/清空按钮
- **底部状态栏**: 统计信息和当前用户显示

### 2. 控制器功能

**控制器文件**: `AdminProductsController.java`

#### 核心API集成:

```java
// 加载商品列表 (分页+搜索+筛选)
GET /api/products?page=&size=&sort=&search=&status=

// 新增商品
POST /api/products

// 修改商品
PUT /api/products/{id}

// 删除商品
DELETE /api/products/{id}

// 上下架操作
PUT /api/products/{id}/status?status=ON/OFF
```

### 3. 权限控制

#### 认证检查:
```java
// 角色权限验证
private boolean isAdmin() {
    return "admin".equals(MainApp.role) || "registrar".equals(MainApp.role);
}

// 请求头注入
requestBuilder.header("Authorization", MainApp.token);
requestBuilder.header("X-ADMIN-TOKEN", "admin-access");
```

## 🔧 技术实现

### 1. 数据模型

```java
public static class ProductModel {
    private final SimpleLongProperty id;
    private final SimpleStringProperty name;
    private final SimpleDoubleProperty price;
    private final SimpleIntegerProperty stock;
    private final SimpleStringProperty status;
    private final SimpleStringProperty description;
}
```

### 2. 表格操作列

```java
// 操作按钮列包含三个按钮
private final Button editButton = new Button("编辑");      // 编辑商品
private final Button deleteButton = new Button("删除");    // 删除商品
private final Button statusButton = new Button("上/下架"); // 状态切换
```

### 3. 状态管理

```java
// 编辑模式标识
private boolean isEditMode = false;

// 表单模式切换
editProduct(ProductModel product)  // 切换到编辑模式
handleAddNew()                     // 切换到新增模式
```

### 4. 数据验证

```java
private boolean validateForm() {
    // 商品名称非空验证
    // 价格数值验证 (>= 0)
    // 库存数值验证 (>= 0)
}
```

## 🎨 界面设计

### 布局特色
- **BorderPane布局**: 顶部工具栏 + 中央内容 + 底部状态栏
- **左右分栏**: 列表与表单分离，提高操作效率
- **全屏显示**: 适合管理大量商品数据
- **响应式设计**: 自适应不同屏幕尺寸

### 颜色系统
- 主要操作: `#3498db` (蓝色) - 编辑
- 危险操作: `#e74c3c` (红色) - 删除
- 警告操作: `#f39c12` (橙色) - 上下架
- 成功操作: `#27ae60` (绿色) - 保存
- 次要操作: `#95a5a6` (灰色) - 刷新

### 状态指示
- 上架商品: 绿色文字 + 粗体
- 下架商品: 红色文字 + 粗体
- 价格显示: ¥xx.xx 格式

## 🚀 操作流程

### 1. 商品列表管理
```
加载列表 → 搜索筛选 → 分页浏览 → 选择操作
```

### 2. 新增商品流程
```
点击"新增商品" → 清空表单 → 填写信息 → 验证 → 保存
```

### 3. 编辑商品流程
```
点击"编辑"按钮 → 加载到表单 → 修改信息 → 验证 → 更新
```

### 4. 删除商品流程
```
点击"删除"按钮 → 确认对话框 → 执行删除 → 刷新列表
```

### 5. 状态切换流程
```
点击"上/下架"按钮 → 确认对话框 → 状态切换 → 刷新列表
```

## 📊 数据交互

### 请求对象
```java
public static class ProductRequest {
    private String name;        // 商品名称
    private Double price;       // 商品价格
    private Integer stock;      // 库存数量
    private String status;      // 商品状态 (ON/OFF)
    private String description; // 商品描述
}
```

### 响应对象
```java
public static class ProductResponse {
    private Long id;            // 商品ID
    private String name;        // 商品名称
    private Double price;       // 商品价格
    private Integer stock;      // 库存数量
    private String status;      // 商品状态
    private String description; // 商品描述
}
```

## ✅ 功能特性

### 1. 搜索和筛选
- **文本搜索**: 支持商品名称或ID搜索
- **状态筛选**: 全部/上架/下架筛选
- **实时查询**: 点击搜索立即刷新结果

### 2. 分页控制
- **分页大小**: 每页20条记录
- **页面导航**: 上一页/下一页按钮
- **页面信息**: 显示当前页/总页数
- **总数统计**: 底部显示商品总数

### 3. 表单验证
- **必填字段**: 商品名称不能为空
- **数值验证**: 价格和库存必须为非负数
- **实时提示**: 验证失败时显示具体错误信息

### 4. 操作反馈
- **状态显示**: 右侧表单底部显示操作状态
- **颜色指示**: 成功(绿色)、失败(红色)、进行中(蓝色)
- **弹窗确认**: 删除和状态切换操作需要二次确认

### 5. 权限控制
- **角色检查**: 仅管理员和注册员可访问
- **令牌认证**: 自动在请求头中添加认证信息
- **访问限制**: 无权限用户显示错误提示

## 🔄 与其他模块集成

### 导航入口
- **管理员界面**: registrar.fxml 添加"商品管理"按钮
- **主应用**: MainApp.openAdminProducts() 方法

### 数据同步
- **商品状态**: 与用户端商品列表状态同步
- **库存更新**: 影响购物车和订单系统
- **价格变动**: 实时反映到商品详情页面

### 权限集成
- **用户角色**: 与MainApp.role集成
- **认证令牌**: 与MainApp.token集成
- **访问控制**: 与后端权限系统对接

## 📱 使用说明

### 管理员访问方式
1. 以管理员身份登录系统
2. 进入管理员界面(registrar.fxml)
3. 点击"商品管理"按钮
4. 页面以全屏模式打开

### 操作指南
1. **查看商品**: 默认加载所有商品，支持搜索和筛选
2. **新增商品**: 点击"新增商品" → 填写表单 → 点击"保存"
3. **编辑商品**: 选择商品行 → 点击"编辑" → 修改表单 → 点击"保存"
4. **删除商品**: 选择商品行 → 点击"删除" → 确认删除
5. **上下架**: 选择商品行 → 点击"上/下架" → 确认操作

这个管理员商品管理功能提供了完整的后台商品管理体验，是电商系统管理端的核心功能模块。
