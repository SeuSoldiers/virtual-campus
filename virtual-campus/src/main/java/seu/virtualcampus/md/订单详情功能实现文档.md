# 订单详情功能实现文档

## 📋 功能概述

订单详情页面提供完整的订单信息展示和确认收货功能，支持订单状态的实时显示和操作。

## 🎯 核心功能

### 1. 页面结构

**FXML文件**: `order_detail.fxml`
- **基本信息区域**: 2x4网格布局展示订单核心信息
- **商品清单区域**: TableView展示订单包含的所有商品
- **操作按钮区域**: 确认收货和返回首页按钮

### 2. 控制器功能

**控制器文件**: `OrderDetailController.java`

#### 核心方法:

```java
// 设置订单ID并触发加载
public void setOrderId(String orderId)

// 页面显示时加载（可选调用）
public void onShown()

// 加载订单详情数据
private void loadOrderDetail()

// 确认收货操作
@FXML private void confirmOrder()

// 返回首页
@FXML private void goBackToHome()
```

### 3. API接口集成

#### 获取订单详情
- **请求**: `GET /api/orders/{orderId}`
- **响应**: 包含订单基本信息和商品清单的完整数据

#### 确认收货
- **请求**: `PUT /api/orders/{orderId}/confirm`
- **功能**: 将订单状态更新为"已确认"
- **权限**: 仅当订单状态为 PAID/SHIPPED/DELIVERED 时可操作

## 🔧 技术实现

### 1. 数据绑定

```java
// 订单项模型使用JavaFX属性绑定
public static class OrderItemModel {
    private final SimpleStringProperty productName;
    private final SimpleDoubleProperty productPrice;
    private final SimpleIntegerProperty quantity;
    private final SimpleDoubleProperty subtotal;
}
```

### 2. 状态管理

```java
// 根据订单状态动态显示操作按钮
private void updateButtonVisibility(String status) {
    confirmButton.setVisible("PAID".equals(status) || 
                           "SHIPPED".equals(status) || 
                           "DELIVERED".equals(status));
}
```

### 3. 用户体验

- **异步加载**: 使用OkHttp异步请求避免界面阻塞
- **错误处理**: 完善的异常捕获和用户友好提示
- **确认对话框**: 确认收货前显示二次确认避免误操作
- **实时刷新**: 操作成功后自动刷新订单详情

## 🎨 界面设计

### 样式特色
- **现代化设计**: 使用圆角、阴影、渐变等视觉效果
- **信息层次**: 通过字体大小、颜色、间距区分信息重要性
- **响应式布局**: GridPane和VBox布局适应不同内容长度
- **状态指示**: 不同订单状态使用不同颜色标识

### 颜色系统
- 主要信息: `#2d3a4a` (深蓝灰)
- 强调内容: `#007bff` (蓝色)、`#e74c3c` (红色)
- 成功操作: `#28a745` (绿色)
- 次要操作: `#6c757d` (灰色)

## 🚀 使用方式

### 从其他页面调用

```java
// 在订单列表或其他页面中打开订单详情
FXMLLoader loader = new FXMLLoader(getClass().getResource("/seu/virtualcampus/ui/order_detail.fxml"));
Parent root = loader.load();

OrderDetailController controller = loader.getController();
controller.setOrderId("123"); // 设置要查看的订单ID

Stage stage = new Stage();
stage.setTitle("订单详情");
stage.setScene(new Scene(root));
stage.show();
```

### 独立页面使用

```java
// 页面显示时调用
controller.onShown();
```

## 📊 数据结构

### 订单详情响应对象

```java
public static class OrderDetailResponse {
    private Long id;              // 订单ID
    private String status;        // 订单状态
    private Double totalAmount;   // 总金额
    private String paymentMethod; // 支付方式
    private String createdAt;     // 创建时间
    private String paidAt;        // 支付时间
    private String deliveredAt;   // 发货时间
    private String confirmedAt;   // 确认时间
    private List<OrderItemResponse> items; // 订单项列表
}
```

### 订单项响应对象

```java
public static class OrderItemResponse {
    private String productName;   // 商品名称
    private Double price;         // 单价
    private Integer quantity;     // 数量
    private Double subtotal;      // 小计
}
```

## ✅ 测试场景

1. **正常查看**: 输入有效订单ID，显示完整订单信息
2. **确认收货**: 对已支付/已发货订单执行确认收货操作
3. **状态限制**: 验证只有特定状态订单才显示确认收货按钮
4. **错误处理**: 测试网络异常、订单不存在等异常情况
5. **导航功能**: 测试返回首页和关闭窗口功能

## 🔄 与其他模块集成

- **订单列表页面**: 提供"查看详情"入口
- **结算页面**: 支付完成后跳转到订单详情
- **首页控制台**: 提供返回入口
- **订单管理系统**: 与后端订单状态同步

这个订单详情功能提供了完整的订单查看和确认收货体验，是电商系统中用户订单管理的重要组成部分。
